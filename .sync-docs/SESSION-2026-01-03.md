# Session Notes - January 3, 2026

## n8n Workflow Setup - YouTube Videos Fetcher

### Overview
Successfully set up n8n workflow automation to automatically fetch YouTube videos from design channels and insert them into Supabase database.

### Workflow URL
https://n8n.thienstyle.com/workflow/EcYUQknGPR0vQwfe

### Completed Tasks

#### 1. Initial Workflow Creation
- Created basic 4-node workflow:
  - Schedule Trigger (Daily at 6 AM)
  - HTTP Request (YouTube Data API v3)
  - Code (Parse & transform data)
  - Supabase (Insert to database)

#### 2. Issues Encountered & Fixed

**Issue 1: YouTube API Authentication**
- Error: 403 Forbidden "Method doesn't allow unregistered callers"
- Cause: Query parameter name was incorrect
- Fix: Changed parameter name from `YOUR_YOUTUBE_API_KEY` to `key`
- API Key: `AIzaSyC0pTb952Xc8WZprjfXBRh2FKRyPwOcFIo`

**Issue 2: Supabase Node Data Mapping**
- Error: "null value in column 'title' violates not-null constraint"
- Cause: Nodes were not connected on canvas
- Fix: Wire Code node output to Supabase node input

**Issue 3: Array Field Format**
- Error: "malformed array literal: 'DesignTutorial'"
- Cause: n8n auto-map converted array to concatenated string
- Fix: Return plain JavaScript array `['Design', 'Tutorial']` from Code node

**Issue 4: Duplicate Key Constraint**
- Error: "duplicate key value violates unique constraint 'resources_url_key'"
- Cause: Videos already exist in database
- Fix: Added duplicate checking logic

#### 3. Final Workflow Implementation

**Added Nodes:**
- **Check If Exists** (Supabase GET):
  - Operation: GET
  - Table: resources
  - Filter: `url = {{ $json.url }}`
  - Returns empty array if not exists

- **If Not Exists** (IF node):
  - Condition: `{{ $json.length }} === 0`
  - True path → Insert to Supabase
  - False path → Skip (Already Exists)

- **Skip (Already Exists)** (NoOp node):
  - Logs skipped videos for monitoring

**Code Node - Final Version:**
```javascript
// Get items from previous node
const items = $input.all();

if (!items || items.length === 0 || !items[0].json.items) {
  return [];
}

const videos = items[0].json.items;
const results = [];

for (const item of videos) {
  const videoId = item.id.videoId;

  results.push({
    title: item.snippet.title,
    description: (item.snippet.description || '').substring(0, 500),
    url: `https://www.youtube.com/watch?v=${videoId}`,
    thumbnail_url: item.snippet.thumbnails?.high?.url || item.snippet.thumbnails?.default?.url,
    channel_name: 'DesignCourse',
    published_at: item.snippet.publishedAt,
    category: 'video-tutorials',
    tags: ['Design', 'Tutorial'],
    featured: false
  });
}

return results;
```

### Files Created/Modified

**New Files:**
- `n8n-workflows/youtube-videos-fetcher-fixed.json` - Complete working workflow with duplicate checking
- `n8n-workflows/youtube-videos-fetcher-v2.json` - Simplified version (deprecated)

**Modified Files:**
- `n8n-workflows/youtube-videos-fetcher.json` - Updated with latest working config
- `n8n-workflows/README.md` - Documentation for workflow setup

### Workflow Features

✅ **Completed Features:**
- Fetch latest 5 videos from YouTube channel (DesignCourse)
- Parse video metadata (title, description, thumbnail, published date)
- Check for duplicates before inserting
- Insert only new videos to Supabase
- Skip existing videos
- Handle array fields correctly (tags)
- Schedule: Daily at 6 AM (cron: `0 6 * * *`)

### Current Configuration

**YouTube API:**
- Endpoint: `https://www.googleapis.com/youtube/v3/search`
- Channel ID: `UCVyRiMvfUNMA1UPlDPzG5Ow` (DesignCourse)
- Max Results: 5 videos
- Order: date (most recent first)

**Supabase:**
- Table: `resources`
- Credential: Supabase account 2 (ID: `nosbOw6TGr2Tl0aJ`)
- Database: `postgres` on `db.kmzcbwiqlfdcrqqndglm.supabase.co`

### Database Schema

**resources table fields:**
- title (text, required)
- description (text)
- url (text, unique)
- category (text) - "video-tutorials"
- tags (text[]) - array of tags
- thumbnail_url (text)
- channel_name (text)
- published_at (timestamp)
- featured (boolean)

### Next Steps (Future Enhancements)

**Planned Features:**
1. **Multi-channel support**: Loop through 13 YouTube channels
   - DesignCourse, Flux Academy, Jesse Showalter
   - The Futur, Charli Marie
   - Motion Design School, School of Motion, Dope Motions
   - DesignWithArash, Blender Guru
   - Josh & Ryuu (Blender Bros)

2. **Video duration**: Add API call to get video duration (contentDetails)

3. **Auto-categorization**: Intelligent tagging based on title/description
   - UI Design, UX Design, Motion Graphics, 3D Design, etc.

4. **Additional workflows**:
   - RSS Inspiration Fetcher (Dribbble, Behance, Awwwards)
   - GitHub Resources Scraper (graphic design repos)
   - Content Cleanup (remove old/outdated content)

### Testing & Monitoring

**Test Results:**
- ✅ Workflow executes successfully
- ✅ Videos fetched from YouTube API
- ✅ Data transformed correctly
- ✅ Duplicate checking works
- ✅ New videos inserted to database
- ✅ Existing videos skipped

**How to Monitor:**
1. Go to n8n Executions tab
2. Filter by workflow name
3. Check execution logs for:
   - Videos fetched
   - Videos inserted (new)
   - Videos skipped (existing)

### Credentials Setup

**Supabase API Credential:**
- Name: Supabase account 2
- ID: `nosbOw6TGr2Tl0aJ`
- Host: `db.kmzcbwiqlfdcrqqndglm.supabase.co`
- Database: `postgres`
- User: `postgres.kmzcbwiqlfdcrqqndglm`
- Port: `5432`
- SSL: Required

**YouTube API Key:**
- Stored in HTTP Request node query parameters
- Key: `AIzaSyC0pTb952Xc8WZprjfXBRh2FKRyPwOcFIo`

### Important Notes

⚠️ **Security:**
- API keys are stored in workflow JSON
- Consider moving to environment variables for production
- Never commit API keys to public repositories

⚠️ **API Quotas:**
- YouTube Data API has daily quota limit (10,000 units/day)
- Each search request costs ~100 units
- Current setup: ~100 units per execution (5 videos from 1 channel)
- Can run 100 times per day before hitting quota

### Status
✅ **COMPLETED & WORKING**

The workflow is now fully functional and ready for production use. It can be activated to run automatically daily at 6 AM to fetch and insert new design tutorial videos from YouTube.

---

## Update: Multi-Channel Workflow with Auto-Categorization

### New Workflow Created: `youtube-videos-fetcher-multi-channel.json`

**Enhanced Features:**
- ✅ Fetches from 11 YouTube channels simultaneously (110 videos per execution)
- ✅ Intelligent auto-categorization based on content analysis
- ✅ Up to 5 relevant tags per video
- ✅ Null safety checks to prevent crashes
- ✅ Channel name mapping for consistent naming

**Channels Added:**
- **UI/UX Design**: DesignCourse, Flux Academy, Jesse Showalter
- **Design Business**: The Futur, Charli Marie
- **Motion Graphics**: Motion Design School, School of Motion, Dope Motions
- **3D Design**: DesignWithArash, Blender Guru, Blender Bros

**Auto-Categorization Logic:**
Analyzes title + description + channel name using regex patterns to detect:
- **Design Categories**: UI Design, UX Design, Web Design, Branding, Graphic Design
- **Motion & 3D**: Motion Graphics, 3D Design, Blender
- **Tools**: Figma, Adobe (Photoshop, Illustrator, XD, Premiere, After Effects), Design Tools
- **Topics**: Tutorial, Portfolio, Typography, Color Theory, Business, AI (Midjourney, DALL-E, ChatGPT)
- **Channel-specific tags**: Motion Design (for motion channels), Blender (for Blender channels), Design Business (for The Futur)

**Keyword Matching Examples:**
- UI Design: `ui`, `user interface`, `interface design`
- Motion Graphics: `motion`, `animation`, `after effects`, `animate`
- 3D Design: `3d`, `blender`, `cinema 4d`, `c4d`, `maya`, `three.js`
- AI: `ai`, `artificial intelligence`, `midjourney`, `dall-e`, `chatgpt`

**Performance Improvements:**
- Processes all 11 channels in parallel
- Expected: 20-50 new videos inserted per day
- YouTube API quota: ~1,100 units per execution (leaves ~9,000 for other tasks)
- Handles null/undefined values gracefully
- Skips invalid videos without crashing

**Bug Fixes:**
- Fixed `toLowerCase()` error on undefined values
- Added null safety checks for title, description, channelName
- Added channel mapping dictionary for proper channel names
- Skip videos with missing videoId or snippet
- Fallback to channelTitle from API if not in channel map

**Files:**
- `youtube-videos-fetcher-multi-channel.json` - ⭐ RECOMMENDED (production-ready)
- `youtube-videos-fetcher-fixed.json` - Single channel for testing
- `youtube-videos-fetcher-v2.json` - Simplified version (deprecated)
- `README.md` - Updated documentation

**Workflow Status:** ✅ TESTED & WORKING
